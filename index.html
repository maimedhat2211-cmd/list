<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Grade 6B FC</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0a0f1f;color:#e6f1ff}
.hidden{display:none}
button{cursor:pointer;background:none;border:none;color:white}
input,textarea{background:#020617;color:white;border:1px solid #333;border-radius:4px;padding:5px}
textarea{width:100%;resize:none;overflow:hidden}
header{padding:10px;font-weight:bold;display:flex;justify-content:flex-start;align-items:center;gap:10px}
.container{width:95%;margin:auto}
.tabs{display:flex;gap:15px;margin-bottom:8px}
.tab{cursor:pointer;color:#aaa;padding:4px 8px;border-radius:4px}
.tab.active{background:#00ff9c;color:black}
.list{background:#020617;padding:10px;border-radius:10px;overflow-x:auto}
.list-header,.row{display:grid;grid-template-columns:40px 160px 80px repeat(6,65px) 60px 50px 50px 50px 120px;gap:6px;align-items:center;min-width:1350px}
.list-header{color:#00ff9c;border-bottom:1px solid #333;padding-bottom:6px}
.row{background:#111827;border-radius:6px;padding:6px;margin-top:6px}
.icon{cursor:pointer;margin:0 4px}
.commentSection{margin-top:10px;background:#020617;padding:10px;border-radius:10px}
.comment{border-bottom:1px solid #333;padding:6px 0}
.statPage{width:95%;margin:auto;background:#020617;padding:15px;border-radius:10px}
.statGrid{display:grid;grid-template-columns:repeat(6,1fr);text-align:center;margin:10px 0}
.statBox{background:#111827;padding:10px;border-radius:8px}
.photo{width:120px;height:120px;border-radius:8px;object-fit:cover;border:1px solid #333}
.badgeIcon{display:inline-block;margin-right:4px;background:#00ff9c;color:black;padding:2px 4px;border-radius:3px;font-size:12px;}
.traitBadgeContainer label{display:inline-block;margin-right:10px;margin-bottom:4px;}
.displayedTraitsBadges{margin-top:8px;}
/* === photo upload additions ONLY === */
.photoWrapper{position:relative;display:inline-block;}
#removePhotoBtn{
  position:absolute;top:0;right:0;
  width:24px;height:24px;
  background:#ff4d4d;color:white;font-weight:bold;
  border:none;border-radius:50%;
  cursor:pointer;display:none;line-height:20px;text-align:center;
}
</style>
</head>
<body>

<header>
  <span id="viewerDisplay"></span>
</header>

<div id="listView" class="container">
  <div class="tabs">
    <div class="tab active" data-list="all" onclick="switchList('all')">All-Time</div>
    <div class="tab" data-list="weekly" onclick="switchList('weekly')">Weekly</div>
    <div class="tab" data-list="monthly" onclick="switchList('monthly')">Monthly</div>
  </div>

  <div style="margin-bottom:6px">
    <input id="newName" placeholder="New player name">
    <button onclick="addPlayer()">Add Player</button>
  </div>

  <div class="list-header">
    <div>#</div><div>Name</div><div>Pos</div>
    <div>PAC</div><div>SHO</div><div>PAS</div>
    <div>DRI</div><div>DEF</div><div>PHY</div>
    <div>OVR</div>
    <div>G</div><div>A</div><div>S</div>
    <div>Actions</div>
  </div>
  <div id="rows"></div>

  <div class="commentSection">
    <h3>Comments</h3>
    <div id="comList"></div>
    <textarea id="cinput" placeholder="Write a comment..." oninput="autoGrow(this)"></textarea>
    <button onclick="addComment()">Send</button>
  </div>
</div>

<div id="statsView" class="statPage hidden">
  <button onclick="back()">‚¨Ö Back</button>
  <h2 id="statName"></h2>

  <!-- photo wrapper -->
  <div class="photoWrapper">
    <img id="playerPhoto" class="photo">
    <button id="removePhotoBtn" onclick="removePhoto()">√ó</button>
  </div><br>
  <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(this)">
  <button onclick="document.getElementById('photoInput').click()">Upload Photo</button>

  <div id="statGrid" class="statGrid"></div>

  <h3>Summary</h3>
  <textarea id="statSummary" oninput="updateSummary()" style="width:100%;resize:none;"></textarea>

  <h3>Traits</h3>
  <div id="traitList" class="traitBadgeContainer"></div>

  <h3>Badges</h3>
  <div id="badgeList" class="traitBadgeContainer"></div>

  <button onclick="saveStatChanges()">Save</button>

  <div class="displayedTraitsBadges">
    <strong>Traits:</strong> <span id="dispTraits"></span><br>
    <strong>Badges:</strong> <span id="dispBadges"></span>
  </div>

  <div class="commentSection">
    <h3>Comments</h3>
    <div id="statComList"></div>
    <textarea id="statCInput" placeholder="Write a comment..." oninput="autoGrow(this)"></textarea>
    <button onclick="addComment(true)">Send</button>
  </div>
</div>

<script>
/* ===== Viewer Code & Display Name ===== */
let access=false;
while(!access){
  const code=prompt("Enter viewer code:");
  if(code==="Grade6B") access=true; else alert("Wrong code!");
}
let viewer = localStorage.getItem("viewerName")||prompt("Enter your display name:");
localStorage.setItem("viewerName",viewer);
const viewerDisplay=document.getElementById("viewerDisplay");
viewerDisplay.innerHTML = viewer+' ‚úèÔ∏è';
viewerDisplay.onclick=function(){
  const n=prompt("Change display name:",viewer);
  if(n){viewer=n;localStorage.setItem("viewerName",viewer);viewerDisplay.innerHTML=viewer+' ‚úèÔ∏è';}
}
const isAdmin = prompt("Admin code (optional):")==="ahmed ghazy";

/* ===== Data ===== */
let traitsList=["Fast","Leader","Playmaker","Dribbler","Defensive Mind","Strong","Vision","Speedster","Tactician","Finisher"];
let badgesList=["Captain","Finisher","Playmaker","Iron Man","Wall","Assist King","Hat-trick Hero","Set Piece","Penalty"];
let lists = JSON.parse(localStorage.getItem("lists")) || {all:[],weekly:[],monthly:[]};
let comments = JSON.parse(localStorage.getItem("comments"))||{all:[],weekly:[],monthly:[]};
let currentPlayer=null;
let activeList="all";

/* ===== Utils ===== */
function save(){localStorage.setItem("lists",JSON.stringify(lists));localStorage.setItem("comments",JSON.stringify(comments));}
function autoGrow(t){t.style.height="auto";t.style.height=t.scrollHeight+"px";}
function ovr(p){const s=p.stats; return Math.round((s.PAC+s.SHO+s.PAS+s.DRI+s.DEF+s.PHY)/6);}
function getWeekNumber(d){d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));return Math.ceil((((d-yearStart)/86400000)+1)/7);}
function checkResets(){
  const now=new Date();
  const currentWeek=getWeekNumber(now)+"-"+now.getFullYear();
  if(localStorage.getItem("lastWeek")!==currentWeek){
    lists.weekly.forEach(p=>p.weekly={G:0,A:0,S:0});
    localStorage.setItem("lastWeek",currentWeek);
  }
  const currentMonth=now.getMonth()+"-"+now.getFullYear();
  if(localStorage.getItem("lastMonth")!==currentMonth){
    lists.monthly.forEach(p=>p.monthly={G:0,A:0,S:0});
    localStorage.setItem("lastMonth",currentMonth);
  }
  save();
}
checkResets();

/* ===== List Rendering ===== */
function switchList(list){
  activeList=list;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelector(`.tab[data-list='${list}']`).classList.add("active");
  renderList();
  renderComments();
}

function renderList(){
  const rows=document.getElementById("rows");
  rows.innerHTML="";
  lists[activeList].forEach((p,i)=>{
    if(!p[activeList]) p[activeList]={G:0,A:0,S:0};
    const G=p[activeList].G||0;
    const A=p[activeList].A||0;
    const S=p[activeList].S||0;
    const o=ovr(p);
    rows.innerHTML+=`
      <div class="row">
        <div>${i+1}</div>
        <input value="${p.name}" ${!isAdmin?"readonly":""} onchange="lists[activeList][${i}].name=this.value;save();renderList()">
        <select ${!isAdmin?"disabled":""} onchange="lists[activeList][${i}].pos=this.value;save();renderList()">
          ${["GK","CB","LB","RB","CM","CDM","CAM","LW","RW","ST"].map(x=>`<option ${x===p.pos?"selected":""}>${x}</option>`).join("")}
        </select>
        ${["PAC","SHO","PAS","DRI","DEF","PHY"].map(s=>`<input type="number" value="${p.stats[s]}" max="99" ${!isAdmin?"readonly":""} onchange="lists[activeList][${i}].stats['${s}']=Math.min(99,+this.value);save();renderList()">`).join("")}
        <div>${o}</div>
        <input type="number" value="${G}" onchange="lists[activeList][${i}]['${activeList}'].G=Math.min(99,+this.value);save();renderList()">
        <input type="number" value="${A}" onchange="lists[activeList][${i}]['${activeList}'].A=Math.min(99,+this.value);save();renderList()">
        <input type="number" value="${S}" onchange="lists[activeList][${i}]['${activeList}'].S=Math.min(99,+this.value);save();renderList()">
        <div>
          <span class="icon" onclick="openStats(${i})">üëÅÔ∏è</span>
          ${isAdmin?`<span class="icon" onclick="moveUp(${i})">‚¨ÜÔ∏è</span><span class="icon" onclick="moveDown(${i})">‚¨áÔ∏è</span><span class="icon" onclick="delPlayer(${i})">üóëÔ∏è</span>`:""}
        </div>
      </div>`;
  });
}

/* ===== Player Ops ===== */
function addPlayer(){
  const name=document.getElementById("newName").value.trim();
  if(!name) return;
  const newPlayer={name,pos:"ST",stats:{PAC:50,SHO:50,PAS:50,DRI:50,DEF:50,PHY:50},all:{G:0,A:0,S:0},weekly:{G:0,A:0,S:0},monthly:{G:0,A:0,S:0},summary:"",traits:[],badges:[],photo:""};
  lists[activeList].push(newPlayer);
  document.getElementById("newName").value="";
  save();renderList();
}
function delPlayer(i){lists[activeList].splice(i,1);save();renderList();}
function moveUp(i){if(i===0)return;[lists[activeList][i],lists[activeList][i-1]]=[lists[activeList][i-1],lists[activeList][i]];save();renderList();}
function moveDown(i){if(i===lists[activeList].length-1)return;[lists[activeList][i],lists[activeList][i+1]]=[lists[activeList][i+1],lists[activeList][i]];save();renderList();}

/* ===== Stat Page ===== */
function openStats(i){
  currentPlayer=i;
  document.getElementById("listView").classList.add("hidden");
  document.getElementById("statsView").classList.remove("hidden");
  const p=lists[activeList][i];
  document.getElementById("statName").innerText=p.name+" ("+p.pos+")";

  // photo display
  const img = document.getElementById("playerPhoto");
  const rm = document.getElementById("removePhotoBtn");
  img.src = p.photo || "";
  if(p.photo){ rm.classList.remove("hidden"); } else { rm.classList.add("hidden"); }

  document.getElementById("statSummary").value=p.summary;
  renderStatGrid();renderTraitsBadges();renderDisplayedTraitsBadges();renderComments(true);
}
function back(){document.getElementById("statsView").classList.add("hidden");document.getElementById("listView").classList.remove("hidden");}

/* ===== Photo Functions ===== */
function handlePhotoUpload(input){
  const file = input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    lists[activeList][currentPlayer].photo = e.target.result;
    save();
    openStats(currentPlayer);
  };
  reader.readAsDataURL(file);
}
function removePhoto(){
  lists[activeList][currentPlayer].photo = "";
  save();
  openStats(currentPlayer);
}

/* ===== Rest: Stats, Traits, Badges, Comments ===== */
function renderStatGrid(){const p=lists[activeList][currentPlayer];const grid=document.getElementById("statGrid");grid.innerHTML="";for(let s in p.stats) grid.innerHTML+=`<div class="statBox"><strong>${s}</strong><br>${p.stats[s]}</div>`;}
function updateSummary(){lists[activeList][currentPlayer].summary=document.getElementById("statSummary").value;}
function renderTraitsBadges(){const tDiv=document.getElementById("traitList");const bDiv=document.getElementById("badgeList");const p=lists[activeList][currentPlayer];tDiv.innerHTML="";bDiv.innerHTML="";traitsList.forEach(tr=>{const sel=p.traits.includes(tr)?'checked':''; tDiv.innerHTML+=`<label><input type="checkbox" ${sel} onchange="toggleTrait('${tr}')">${tr}</label>`;});badgesList.forEach(bd=>{const sel=p.badges.includes(bd)?'checked':''; bDiv.innerHTML+=`<label><input type="checkbox" ${sel} onchange="toggleBadge('${bd}')"> <span class="badgeIcon">${bd}</span></label>`;});}
function toggleTrait(tr){const t=lists[activeList][currentPlayer].traits; t.includes(tr)?t.splice(t.indexOf(tr),1):t.push(tr); renderDisplayedTraitsBadges();}
function toggleBadge(bd){const t=lists[activeList][currentPlayer].badges; t.includes(bd)?t.splice(t.indexOf(bd),1):t.push(bd); renderDisplayedTraitsBadges();}
function saveStatChanges(){updateSummary();save();renderList();back();}
function renderDisplayedTraitsBadges(){const p=lists[activeList][currentPlayer];document.getElementById("dispTraits").innerText=p.traits.join(", ");document.getElementById("dispBadges").innerHTML=p.badges.map(bd=>`<span class="badgeIcon">${bd}</span>`).join(" ");}

/* ===== Comments ===== */
function renderComments(stat=false){const listEl=stat?document.getElementById("statComList"):document.getElementById("comList");listEl.innerHTML="";const cList=comments[activeList]||[];cList.forEach((c,i)=>{const liked=c.likes?.includes(viewer)||false;const disliked=c.dislikes?.includes(viewer)||false;listEl.innerHTML+=`<div class="comment"><small>${c.author} ‚Ä¢ ${c.time}</small><br>${c.text}<br>Likes: ${c.likes?.length||0} <span class="icon" onclick="toggleLike(${i})">${liked?'üëç':'üëç'}</span> Dislikes: ${c.dislikes?.length||0} <span class="icon" onclick="toggleDislike(${i})">${disliked?'üëé':'üëé'}</span> ${c.author===viewer?`<span class="icon" onclick="editComment(${i})">‚úèÔ∏è</span>`:""} ${isAdmin?`<span class="icon" onclick="delComment(${i})">üóëÔ∏è</span>`:""}</div>`;});}
function addComment(stat=false){const input=stat?document.getElementById("statCInput"):document.getElementById("cinput");if(!input.value) return;if(!comments[activeList]) comments[activeList]=[];comments[activeList].push({author:viewer,text:input.value,time:new Date().toLocaleString(),likes:[],dislikes:[]});input.value="";autoGrow(input);save();renderComments(stat);}
function editComment(i){const n=prompt("Edit comment",comments[activeList][i].text);if(n){comments[activeList][i].text=n;save();renderComments();}}
function delComment(i){comments[activeList].splice(i,1);save();renderComments();}
function toggleLike(i){const c=comments[activeList][i];c.likes=c.likes||[];c.dislikes=c.dislikes||[];if(c.likes.includes(viewer)){c.likes=c.likes.filter(x=>x!==viewer);}else{c.likes.push(viewer);c.dislikes=c.dislikes.filter(x=>x!==viewer);}save();renderComments(document.getElementById("statsView").classList.contains("hidden")?false:true);}
function toggleDislike(i){const c=comments[activeList][i];c.likes=c.likes||[];c.dislikes=c.dislikes||[];if(c.dislikes.includes(viewer)){c.dislikes=c.dislikes.filter(x=>x!==viewer);}else{c.dislikes.push(viewer);c.likes=c.likes.filter(x=>x!==viewer);}save();renderComments(document.getElementById("statsView").classList.contains("hidden")?false:true);}

/* ===== Initialization ===== */
['all','weekly','monthly'].forEach(k=>{if(!lists[k]) lists[k]=[]; if(!comments[k]) comments[k]=[]; lists[k].forEach(p=>{if(!p.stats)p.stats={PAC:50,SHO:50,PAS:50,DRI:50,DEF:50,PHY:50};});});
save();renderList();renderComments();
</script>
</body>
</html>
